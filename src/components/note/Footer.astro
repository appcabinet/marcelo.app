---
---
<style>
  footer {
    height: auto;
    padding-bottom: 8rem;
  }
  
  footer h2 {
    margin: 0;
  }

  .newsletter {
    max-width: 32rem;
  }

  .newsletter h2 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
  }

  .newsletter p {
    font-size: 1rem;
    margin-bottom: 1.5rem;
    color: var(--text-light);
  }

  .form-container {
    display: flex;
    gap: 0.5rem;
  }

  .email-input {
    flex: 1;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    /* border: 1px solid var(--border-color, #e2e8f0); */
    /* border-radius: 0.375rem; */
    /* background: white; */
    /* color: var(--text-dark); */
  }

  .email-input:focus {
    outline: none;
    box-shadow: 0 0 0 1px var(--background-core-dark);
  }

  .submit-button {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
  }

  .submit-button:hover {
    background: var(--background-core-dark);
    cursor: pointer;
  }

  .error-message {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.5rem;
    display: none;
  }

  .success-message {
    color: #10b981;
    font-size: 0.875rem;
    margin-top: 0.5rem;
    display: none;
  }
</style>

<footer>
  <div class="newsletter">
    <h2>Receive my updates</h2>
    <p>Follow me via email, <a href="/rss.xml">RSS</a>, <a href="https://x.com/marcelodotapp">Twitter</a>, and <a href="#">other options</a></p>
    
    <form id="newsletter-form" class="form-container" method="POST">
      <input 
        type="email" 
        id="email-input"
        class="email-input"
        placeholder="Enter your email"
        required
      />
      <button type="submit" class="submit-button">
        Sign up
      </button>
    </form>
    <p id="error-message" class="error-message"></p>
    <p id="success-message" class="success-message"></p>
  </div>
</footer>

<script>
  const form = document.getElementById('newsletter-form');
  const emailInput = document.getElementById('email-input');
  const errorMessage = document.getElementById('error-message');
  const successMessage = document.getElementById('success-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!emailInput || !errorMessage || !successMessage) return;
    
    const email = (emailInput as HTMLInputElement).value;
    
    // Reset messages
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';

    try {
      const response = await fetch('https://api.buttondown.email/v1/subscribers', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Token ${import.meta.env.BUTTONDOWN_API_KEY}`
        },
        body: JSON.stringify({ email_address: email })
      });

      if (!response.ok) {
        throw new Error('Subscription failed');
      }

      // Success
      (emailInput as HTMLInputElement).value = '';
      successMessage.textContent = 'Thanks for subscribing!';
      successMessage.style.display = 'block';
    } catch (err) {
      // Error
      errorMessage.textContent = 'Something went wrong. Please try again.';
      errorMessage.style.display = 'block';
    }
  });
</script>
